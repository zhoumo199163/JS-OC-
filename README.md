# ZMJS-OC
## UIWebView-JavaScriptCore
1.获取js上下文，确定与js通讯的key
```
 //获取当前js页面上下文
    _jsContext = [webView valueForKeyPath:@"documentView.webView.mainFrame.javaScriptContext"];
    //设定和js通信标识
    _jsContext[@"jsIdentify"] = self;
    _jsContext.exceptionHandler = ^(JSContext *context, JSValue *exception){
        context.exception = exception;
        NSLog(@"异常信息：%@", exception);
    };

```
2.在OC中定义js需要调用的方法  
```
@protocol  ZMWebJavaScriptMethods<JSExport>

- (void)sendMessageWithNoParam; //无参数
- (void)sendMessageWithOneParam:(id)message; //单参数
JSExportAs(sendMessageWithMoreParam,// 多参数，sendMessageWithMoreParam作为JS调用的方法名
           - (void)sendMessageWithMoreParam:(id)message toSomeOne:(id)someOne
           );
 //多参数因为js无法识别，所以需要使用JSExportAs起一个别名
 /*
 When a selector that takes one or more arguments is converted to a JavaScript
 property name, by default a property name will be generated by performing the
 following conversion:
  - All colons are removed from the selector
  - Any lowercase letter that had followed a colon will be capitalized.
  */
@end
```
3.在html中直接调用
```
 <input type="button" value="html发消息给OC，单参数" onclick="jsIdentify.sendMessageWithOneParam('我来自html')">
```
4.通过js调用
```
//标识.方法名（参数...）
jsIdentify.sendMessageWithMoreParam(value1,value2)
```
5.OC调用js
```
JSValue *callJS = _jsContext[mothedName];
 [callJS callWithArguments:arguments];
```

##WKWebView
1.创建交互Config
```
/*
 Adding a scriptMessageHandler adds a function
 window.webkit.messageHandlers.<name>.postMessage(<messageBody>) for all
 frames.
 */
 WKWebViewConfiguration *config = [[WKWebViewConfiguration alloc] init];
    // 交互对象设置
 [config.userContentController addScriptMessageHandler:self name:@"handlerName"];

```
2.js调用OC
```
// window.webkit.messageHandlers.<name>.postMessage(<messageBody>)
 window.webkit.messageHandlers.handlerName.postMessage({functionName: 'sendMessageFromWKWithMoreParam',param:'WkGetTheMessageFromJS'})
```
3.OC调用js
```
// js调用后会到这个delegate方法中
#pragma mark - WKScriptMessageHandler
- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message{
    NSDictionary *dic = [NSDictionary dictionaryWithDictionary:message.body];
    NSString *js = [NSString stringWithFormat:@"%@(\'%@\')", dic[@"functionName"],dic[@"param"]];
    //OC调用一段js代码
    [_wkWebView evaluateJavaScript:js completionHandler:nil];
}

```
